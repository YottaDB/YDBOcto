# Load customers DDL

# Stage 1 : Run 6 queries from TC030.sql that use CUSTOMERS and ORDERS tables
# Verify generated _ydbocto*.m and _ydbocto*.o plan files
_ydboctoP*.m
_ydboctoP*.o
_ydboctoP*.m
_ydboctoP*.o
_ydboctoP*.m
_ydboctoP*.o
_ydboctoP*.m
_ydboctoP*.o
_ydboctoP*.m
_ydboctoP*.o
_ydboctoP*.m
_ydboctoP*.o
_ydboctoX*.m
_ydboctoX*.o
_ydboctoX*.m
_ydboctoX*.o
_ydboctoX*.m
_ydboctoX*.o
# Verify how many queries created new plans
[ INFO] PATH:LINENUM DATE TIME : INFO_M_PLAN : Generating M file [$PWD/_ydboctoP*.m] (to execute SQL query)
[ INFO] PATH:LINENUM DATE TIME : INFO_M_PLAN : Generating M file [$PWD/_ydboctoP*.m] (to execute SQL query)
[ INFO] PATH:LINENUM DATE TIME : INFO_M_PLAN : Generating M file [$PWD/_ydboctoP*.m] (to execute SQL query)
[ INFO] PATH:LINENUM DATE TIME : INFO_M_PLAN : Generating M file [$PWD/_ydboctoP*.m] (to execute SQL query)
[ INFO] PATH:LINENUM DATE TIME : INFO_M_PLAN : Generating M file [$PWD/_ydboctoP*.m] (to execute SQL query)
[ INFO] PATH:LINENUM DATE TIME : INFO_M_PLAN : Generating M file [$PWD/_ydboctoP*.m] (to execute SQL query)
# Verify db nodes correctly represent tables and plans (including xref plans) that rely on them
^%ydboctoocto("tableplans","CUSTOMERS","$PWD/_ydboctoP*.m")=""
^%ydboctoocto("tableplans","CUSTOMERS","$PWD/_ydboctoP*.m")=""
^%ydboctoocto("tableplans","CUSTOMERS","$PWD/_ydboctoP*.m")=""
^%ydboctoocto("tableplans","CUSTOMERS","$PWD/_ydboctoX*.m")=""
^%ydboctoocto("tableplans","ORDERS","$PWD/_ydboctoP*.m")=""
^%ydboctoocto("tableplans","ORDERS","$PWD/_ydboctoP*.m")=""
^%ydboctoocto("tableplans","ORDERS","$PWD/_ydboctoP*.m")=""
^%ydboctoocto("tableplans","ORDERS","$PWD/_ydboctoP*.m")=""
^%ydboctoocto("tableplans","ORDERS","$PWD/_ydboctoX*.m")=""
^%ydboctoocto("tableplans","ORDERS","$PWD/_ydboctoX*.m")=""
# Verify db nodes correctly represent functions and plans that rely on them
# Verify db nodes for plans that are reusable (i.e. do not need to be regenerated)
^%ydboctoocto("plan_metadata","$PWD/_ydboctoP*.m","output_key")="3"
^%ydboctoocto("plan_metadata","$PWD/_ydboctoP*.m","output_key")="3"
^%ydboctoocto("plan_metadata","$PWD/_ydboctoP*.m","output_key")="3"
^%ydboctoocto("plan_metadata","$PWD/_ydboctoP*.m","output_key")="3"
^%ydboctoocto("plan_metadata","$PWD/_ydboctoP*.m","output_key")="3"
^%ydboctoocto("plan_metadata","$PWD/_ydboctoP*.m","output_key")="4"
^%ydboctoocto("plan_metadata","$PWD/_ydboctoX*.m","output_key")="1"
^%ydboctoocto("plan_metadata","$PWD/_ydboctoX*.m","output_key")="1"
^%ydboctoocto("plan_metadata","$PWD/_ydboctoX*.m","output_key")="1"
# Verify db nodes correctly represent cross-references
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C="^customers"
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(0)="*YottaDB*"
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(1)="1"
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(1,"George",1)=""
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(1,"James",4)=""
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(1,"James",5)=""
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(1,"John",2)=""
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(1,"Thomas",3)=""
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(2)="|"
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(3)="#1"
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(4)="#1"
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(5)=""
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(6)="+^customers(sub1=*) -command=set -name=%ydbE7chspaSKyAUuPbW0nWu8CS -xecute=<<"_$C(10)_" for i=1 set p=$piece($ztoldval,""|"",i),q=$piece($ztvalue,""|"",i) do"_$C(10)_" . if p'=q zkill ^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(i,p,sub1) set ^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(i,q,sub1)="""""_$C(10)_" . else  set:'$zlength(q) ^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(i,"""",sub1)="""""_$C(10)
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(7)="+^customers(sub1=*) -command=kill -name=%ydbE7chspaSKyAUuPbW0nWu8CK -xecute=<<"_$C(10)_" do dft($reference) quit"_$C(10)_" if ^%ydbAIMDE7chspaSKyAUuPbW0nWu8C"_$C(10)_"dft(var)"_$C(10)_" new sub,vard,vars,varsd,vsroot"_$C(10)_" set vard=$data(@var)"_$C(10)_" do:vard\10"_$C(10)_" . if $qlength(var) set vsroot=$zextract(var,1,$zlength(var)-1)_"","""_$C(10)_" . else  set vsroot=var_""("""_$C(10)_" . set vars=vsroot_""sub)"""_$C(10)_" . set sub="""" for  do  set sub=$order(@vars) quit:'$zlength(sub)"_$C(10)_" . . set varsd=$data(@vars)"_$C(10)_" . . if varsd\10 do dft(vsroot_$zwrite(sub)_"")"")"_$C(10)_" . . else  kill:varsd#10 @(vsroot_$zwrite(sub)_"")"")"_$C(10)_" zkill:vard#10 @var"_$C(10)_" quit"_$C(10)
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(8)="+^customers(sub1=*) -command=zkill -name=%ydbE7chspaSKyAUuPbW0nWu8CZ -xecute=""for i=1 zkill ^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(i,$piece($ztoldval,""""|"""",i),sub1)"""
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(9)="1"
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(10)="0"
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(12)="+^customers -command=kill -name=%ydbE7chspaSKyAUuPbW0nWu8C0 -xecute=<<"_$C(10)_" do dft($reference) quit"_$C(10)_" if ^%ydbAIMDE7chspaSKyAUuPbW0nWu8C"_$C(10)_"dft(var)"_$C(10)_" new sub,vard,vars,varsd,vsroot"_$C(10)_" set vard=$data(@var)"_$C(10)_" do:vard\10"_$C(10)_" . if $qlength(var) set vsroot=$zextract(var,1,$zlength(var)-1)_"","""_$C(10)_" . else  set vsroot=var_""("""_$C(10)_" . set vars=vsroot_""sub)"""_$C(10)_" . set sub="""" for  do  set sub=$order(@vars) quit:'$zlength(sub)"_$C(10)_" . . set varsd=$data(@vars)"_$C(10)_" . . if varsd\10 do dft(vsroot_$zwrite(sub)_"")"")"_$C(10)_" . . else  kill:varsd#10 @(vsroot_$zwrite(sub)_"")"")"_$C(10)_" zkill:vard#10 @var"_$C(10)_" quit"_$C(10)
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C("comment-1")="xref for table CUSTOMERS column FIRST_NAME"
^%ydbAIMDjrxHoM6teHpBHmytfyBe36="^orders"
^%ydbAIMDjrxHoM6teHpBHmytfyBe36(0)="*YottaDB*"
^%ydbAIMDjrxHoM6teHpBHmytfyBe36(1)="1"
^%ydbAIMDjrxHoM6teHpBHmytfyBe36(1,"03/14/1760",2)=""
^%ydbAIMDjrxHoM6teHpBHmytfyBe36(1,"05/23/1784",3)=""
^%ydbAIMDjrxHoM6teHpBHmytfyBe36(1,"07/04/1776",1)=""
^%ydbAIMDjrxHoM6teHpBHmytfyBe36(1,"07/21/1795",5)=""
^%ydbAIMDjrxHoM6teHpBHmytfyBe36(1,"09/03/1790",4)=""
^%ydbAIMDjrxHoM6teHpBHmytfyBe36(1,"11/27/1787",6)=""
^%ydbAIMDjrxHoM6teHpBHmytfyBe36(2)="|"
^%ydbAIMDjrxHoM6teHpBHmytfyBe36(2,"$124.00",3)=""
^%ydbAIMDjrxHoM6teHpBHmytfyBe36(2,"$14.40",6)=""
^%ydbAIMDjrxHoM6teHpBHmytfyBe36(2,"$234.56",1)=""
^%ydbAIMDjrxHoM6teHpBHmytfyBe36(2,"$25.50",5)=""
^%ydbAIMDjrxHoM6teHpBHmytfyBe36(2,"$65.50",4)=""
^%ydbAIMDjrxHoM6teHpBHmytfyBe36(2,"$78.50",2)=""
^%ydbAIMDjrxHoM6teHpBHmytfyBe36(3)="#11"
^%ydbAIMDjrxHoM6teHpBHmytfyBe36(4)="#11"
^%ydbAIMDjrxHoM6teHpBHmytfyBe36(5)=""
^%ydbAIMDjrxHoM6teHpBHmytfyBe36(6)="+^orders(sub1=*) -command=set -name=%ydbjrxHoM6teHpBHmytfyBe36S -xecute=<<"_$C(10)_" for i=1,2 set p=$piece($ztoldval,""|"",i),q=$piece($ztvalue,""|"",i) do"_$C(10)_" . if p'=q zkill ^%ydbAIMDjrxHoM6teHpBHmytfyBe36(i,p,sub1) set ^%ydbAIMDjrxHoM6teHpBHmytfyBe36(i,q,sub1)="""""_$C(10)_" . else  set:'$zlength(q) ^%ydbAIMDjrxHoM6teHpBHmytfyBe36(i,"""",sub1)="""""_$C(10)
^%ydbAIMDjrxHoM6teHpBHmytfyBe36(7)="+^orders(sub1=*) -command=kill -name=%ydbjrxHoM6teHpBHmytfyBe36K -xecute=<<"_$C(10)_" do dft($reference) quit"_$C(10)_" if ^%ydbAIMDjrxHoM6teHpBHmytfyBe36"_$C(10)_"dft(var)"_$C(10)_" new sub,vard,vars,varsd,vsroot"_$C(10)_" set vard=$data(@var)"_$C(10)_" do:vard\10"_$C(10)_" . if $qlength(var) set vsroot=$zextract(var,1,$zlength(var)-1)_"","""_$C(10)_" . else  set vsroot=var_""("""_$C(10)_" . set vars=vsroot_""sub)"""_$C(10)_" . set sub="""" for  do  set sub=$order(@vars) quit:'$zlength(sub)"_$C(10)_" . . set varsd=$data(@vars)"_$C(10)_" . . if varsd\10 do dft(vsroot_$zwrite(sub)_"")"")"_$C(10)_" . . else  kill:varsd#10 @(vsroot_$zwrite(sub)_"")"")"_$C(10)_" zkill:vard#10 @var"_$C(10)_" quit"_$C(10)
^%ydbAIMDjrxHoM6teHpBHmytfyBe36(8)="+^orders(sub1=*) -command=zkill -name=%ydbjrxHoM6teHpBHmytfyBe36Z -xecute=""for i=1,2 zkill ^%ydbAIMDjrxHoM6teHpBHmytfyBe36(i,$piece($ztoldval,""""|"""",i),sub1)"""
^%ydbAIMDjrxHoM6teHpBHmytfyBe36(9)="1"
^%ydbAIMDjrxHoM6teHpBHmytfyBe36(10)="0"
^%ydbAIMDjrxHoM6teHpBHmytfyBe36(12)="+^orders -command=kill -name=%ydbjrxHoM6teHpBHmytfyBe360 -xecute=<<"_$C(10)_" do dft($reference) quit"_$C(10)_" if ^%ydbAIMDjrxHoM6teHpBHmytfyBe36"_$C(10)_"dft(var)"_$C(10)_" new sub,vard,vars,varsd,vsroot"_$C(10)_" set vard=$data(@var)"_$C(10)_" do:vard\10"_$C(10)_" . if $qlength(var) set vsroot=$zextract(var,1,$zlength(var)-1)_"","""_$C(10)_" . else  set vsroot=var_""("""_$C(10)_" . set vars=vsroot_""sub)"""_$C(10)_" . set sub="""" for  do  set sub=$order(@vars) quit:'$zlength(sub)"_$C(10)_" . . set varsd=$data(@vars)"_$C(10)_" . . if varsd\10 do dft(vsroot_$zwrite(sub)_"")"")"_$C(10)_" . . else  kill:varsd#10 @(vsroot_$zwrite(sub)_"")"")"_$C(10)_" zkill:vard#10 @var"_$C(10)_" quit"_$C(10)
^%ydbAIMDjrxHoM6teHpBHmytfyBe36("comment-1")="xref for table ORDERS column ORDER_DATE"
^%ydbAIMDjrxHoM6teHpBHmytfyBe36("comment-2")="xref for table ORDERS column ORDER_AMOUNT"
^%ydbAIMDxref("^customers","^%ydbAIMDE7chspaSKyAUuPbW0nWu8C")=""
^%ydbAIMDxref("^orders","^%ydbAIMDjrxHoM6teHpBHmytfyBe36")=""
^%ydbAIMOctoCache("CUSTOMERS","FIRST_NAME","completed?")="1"
^%ydbAIMOctoCache("CUSTOMERS","FIRST_NAME","location")="^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(1)"
^%ydbAIMOctoCache("ORDERS","ORDER_AMOUNT","completed?")="1"
^%ydbAIMOctoCache("ORDERS","ORDER_AMOUNT","location")="^%ydbAIMDjrxHoM6teHpBHmytfyBe36(2)"
^%ydbAIMOctoCache("ORDERS","ORDER_DATE","completed?")="1"
^%ydbAIMOctoCache("ORDERS","ORDER_DATE","location")="^%ydbAIMDjrxHoM6teHpBHmytfyBe36(1)"
# Verify db nodes correctly represent src/obj dirs of generated plans (including xref plans)
^%ydboctoocto("plandirs","$PWD/_ydboctoP*.m","$PWD/_ydboctoP*.o")=""
^%ydboctoocto("plandirs","$PWD/_ydboctoP*.m","$PWD/_ydboctoP*.o")=""
^%ydboctoocto("plandirs","$PWD/_ydboctoP*.m","$PWD/_ydboctoP*.o")=""
^%ydboctoocto("plandirs","$PWD/_ydboctoP*.m","$PWD/_ydboctoP*.o")=""
^%ydboctoocto("plandirs","$PWD/_ydboctoP*.m","$PWD/_ydboctoP*.o")=""
^%ydboctoocto("plandirs","$PWD/_ydboctoP*.m","$PWD/_ydboctoP*.o")=""
^%ydboctoocto("plandirs","$PWD/_ydboctoX*.m","$PWD/_ydboctoX*.o")=""
^%ydboctoocto("plandirs","$PWD/_ydboctoX*.m","$PWD/_ydboctoX*.o")=""
^%ydboctoocto("plandirs","$PWD/_ydboctoX*.m","$PWD/_ydboctoX*.o")=""
# Verify currently installed triggers
;trigger name: %ydbE7chspaSKyAUuPbW0nWu8CS (region DEFAULT)  cycle: 4
+^customers(sub1=*) -name=%ydbE7chspaSKyAUuPbW0nWu8CS -commands=S -xecute=<<
 for i=1 set p=$piece($ztoldval,"|",i),q=$piece($ztvalue,"|",i) do
 . if p'=q zkill ^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(i,p,sub1) set ^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(i,q,sub1)=""
 . else  set:'$zlength(q) ^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(i,"",sub1)=""
>>
;trigger name: %ydbE7chspaSKyAUuPbW0nWu8CK (region DEFAULT)  cycle: 4
+^customers(sub1=*) -name=%ydbE7chspaSKyAUuPbW0nWu8CK -commands=K -xecute=<<
 do dft($reference) quit
 if ^%ydbAIMDE7chspaSKyAUuPbW0nWu8C
dft(var)
 new sub,vard,vars,varsd,vsroot
 set vard=$data(@var)
 do:vard\10
 . if $qlength(var) set vsroot=$zextract(var,1,$zlength(var)-1)_","
 . else  set vsroot=var_"("
 . set vars=vsroot_"sub)"
 . set sub="" for  do  set sub=$order(@vars) quit:'$zlength(sub)
 . . set varsd=$data(@vars)
 . . if varsd\10 do dft(vsroot_$zwrite(sub)_")")
 . . else  kill:varsd#10 @(vsroot_$zwrite(sub)_")")
 zkill:vard#10 @var
 quit
>>
;trigger name: %ydbE7chspaSKyAUuPbW0nWu8CZ (region DEFAULT)  cycle: 4
+^customers(sub1=*) -name=%ydbE7chspaSKyAUuPbW0nWu8CZ -commands=ZK -xecute="for i=1 zkill ^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(i,$piece($ztoldval,""|"",i),sub1)"
;trigger name: %ydbE7chspaSKyAUuPbW0nWu8C0 (region DEFAULT)  cycle: 4
+^customers -name=%ydbE7chspaSKyAUuPbW0nWu8C0 -commands=K -xecute=<<
 do dft($reference) quit
 if ^%ydbAIMDE7chspaSKyAUuPbW0nWu8C
dft(var)
 new sub,vard,vars,varsd,vsroot
 set vard=$data(@var)
 do:vard\10
 . if $qlength(var) set vsroot=$zextract(var,1,$zlength(var)-1)_","
 . else  set vsroot=var_"("
 . set vars=vsroot_"sub)"
 . set sub="" for  do  set sub=$order(@vars) quit:'$zlength(sub)
 . . set varsd=$data(@vars)
 . . if varsd\10 do dft(vsroot_$zwrite(sub)_")")
 . . else  kill:varsd#10 @(vsroot_$zwrite(sub)_")")
 zkill:vard#10 @var
 quit
>>
;trigger name: %ydbjrxHoM6teHpBHmytfyBe36S (region DEFAULT)  cycle: 12
+^orders(sub1=*) -name=%ydbjrxHoM6teHpBHmytfyBe36S -commands=S -xecute=<<
 for i=1,2 set p=$piece($ztoldval,"|",i),q=$piece($ztvalue,"|",i) do
 . if p'=q zkill ^%ydbAIMDjrxHoM6teHpBHmytfyBe36(i,p,sub1) set ^%ydbAIMDjrxHoM6teHpBHmytfyBe36(i,q,sub1)=""
 . else  set:'$zlength(q) ^%ydbAIMDjrxHoM6teHpBHmytfyBe36(i,"",sub1)=""
>>
;trigger name: %ydbjrxHoM6teHpBHmytfyBe36K (region DEFAULT)  cycle: 12
+^orders(sub1=*) -name=%ydbjrxHoM6teHpBHmytfyBe36K -commands=K -xecute=<<
 do dft($reference) quit
 if ^%ydbAIMDjrxHoM6teHpBHmytfyBe36
dft(var)
 new sub,vard,vars,varsd,vsroot
 set vard=$data(@var)
 do:vard\10
 . if $qlength(var) set vsroot=$zextract(var,1,$zlength(var)-1)_","
 . else  set vsroot=var_"("
 . set vars=vsroot_"sub)"
 . set sub="" for  do  set sub=$order(@vars) quit:'$zlength(sub)
 . . set varsd=$data(@vars)
 . . if varsd\10 do dft(vsroot_$zwrite(sub)_")")
 . . else  kill:varsd#10 @(vsroot_$zwrite(sub)_")")
 zkill:vard#10 @var
 quit
>>
;trigger name: %ydbjrxHoM6teHpBHmytfyBe36Z (region DEFAULT)  cycle: 12
+^orders(sub1=*) -name=%ydbjrxHoM6teHpBHmytfyBe36Z -commands=ZK -xecute="for i=1,2 zkill ^%ydbAIMDjrxHoM6teHpBHmytfyBe36(i,$piece($ztoldval,""|"",i),sub1)"
;trigger name: %ydbjrxHoM6teHpBHmytfyBe360 (region DEFAULT)  cycle: 12
+^orders -name=%ydbjrxHoM6teHpBHmytfyBe360 -commands=K -xecute=<<
 do dft($reference) quit
 if ^%ydbAIMDjrxHoM6teHpBHmytfyBe36
dft(var)
 new sub,vard,vars,varsd,vsroot
 set vard=$data(@var)
 do:vard\10
 . if $qlength(var) set vsroot=$zextract(var,1,$zlength(var)-1)_","
 . else  set vsroot=var_"("
 . set vars=vsroot_"sub)"
 . set sub="" for  do  set sub=$order(@vars) quit:'$zlength(sub)
 . . set varsd=$data(@vars)
 . . if varsd\10 do dft(vsroot_$zwrite(sub)_")")
 . . else  kill:varsd#10 @(vsroot_$zwrite(sub)_")")
 zkill:vard#10 @var
 quit
>>

# Stage 2 : Run DROP TABLE of ORDERS
DROP TABLE
# Verify generated _ydbocto*.m and _ydbocto*.o plan files
_ydboctoP*.m
_ydboctoP*.o
_ydboctoP*.m
_ydboctoP*.o
_ydboctoX*.m
_ydboctoX*.o
# Verify how many queries created new plans
# Verify db nodes correctly represent tables and plans (including xref plans) that rely on them
^%ydboctoocto("tableplans","CUSTOMERS","$PWD/_ydboctoP*.m")=""
^%ydboctoocto("tableplans","CUSTOMERS","$PWD/_ydboctoP*.m")=""
^%ydboctoocto("tableplans","CUSTOMERS","$PWD/_ydboctoP*.m")=""
^%ydboctoocto("tableplans","CUSTOMERS","$PWD/_ydboctoX*.m")=""
# Verify db nodes correctly represent functions and plans that rely on them
# Verify db nodes for plans that are reusable (i.e. do not need to be regenerated)
^%ydboctoocto("plan_metadata","$PWD/_ydboctoP*.m","output_key")="3"
^%ydboctoocto("plan_metadata","$PWD/_ydboctoP*.m","output_key")="3"
^%ydboctoocto("plan_metadata","$PWD/_ydboctoX*.m","output_key")="1"
# Verify db nodes correctly represent cross-references
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C="^customers"
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(0)="*YottaDB*"
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(1)="1"
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(1,"George",1)=""
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(1,"James",4)=""
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(1,"James",5)=""
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(1,"John",2)=""
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(1,"Thomas",3)=""
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(2)="|"
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(3)="#1"
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(4)="#1"
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(5)=""
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(6)="+^customers(sub1=*) -command=set -name=%ydbE7chspaSKyAUuPbW0nWu8CS -xecute=<<"_$C(10)_" for i=1 set p=$piece($ztoldval,""|"",i),q=$piece($ztvalue,""|"",i) do"_$C(10)_" . if p'=q zkill ^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(i,p,sub1) set ^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(i,q,sub1)="""""_$C(10)_" . else  set:'$zlength(q) ^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(i,"""",sub1)="""""_$C(10)
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(7)="+^customers(sub1=*) -command=kill -name=%ydbE7chspaSKyAUuPbW0nWu8CK -xecute=<<"_$C(10)_" do dft($reference) quit"_$C(10)_" if ^%ydbAIMDE7chspaSKyAUuPbW0nWu8C"_$C(10)_"dft(var)"_$C(10)_" new sub,vard,vars,varsd,vsroot"_$C(10)_" set vard=$data(@var)"_$C(10)_" do:vard\10"_$C(10)_" . if $qlength(var) set vsroot=$zextract(var,1,$zlength(var)-1)_"","""_$C(10)_" . else  set vsroot=var_""("""_$C(10)_" . set vars=vsroot_""sub)"""_$C(10)_" . set sub="""" for  do  set sub=$order(@vars) quit:'$zlength(sub)"_$C(10)_" . . set varsd=$data(@vars)"_$C(10)_" . . if varsd\10 do dft(vsroot_$zwrite(sub)_"")"")"_$C(10)_" . . else  kill:varsd#10 @(vsroot_$zwrite(sub)_"")"")"_$C(10)_" zkill:vard#10 @var"_$C(10)_" quit"_$C(10)
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(8)="+^customers(sub1=*) -command=zkill -name=%ydbE7chspaSKyAUuPbW0nWu8CZ -xecute=""for i=1 zkill ^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(i,$piece($ztoldval,""""|"""",i),sub1)"""
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(9)="1"
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(10)="0"
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(12)="+^customers -command=kill -name=%ydbE7chspaSKyAUuPbW0nWu8C0 -xecute=<<"_$C(10)_" do dft($reference) quit"_$C(10)_" if ^%ydbAIMDE7chspaSKyAUuPbW0nWu8C"_$C(10)_"dft(var)"_$C(10)_" new sub,vard,vars,varsd,vsroot"_$C(10)_" set vard=$data(@var)"_$C(10)_" do:vard\10"_$C(10)_" . if $qlength(var) set vsroot=$zextract(var,1,$zlength(var)-1)_"","""_$C(10)_" . else  set vsroot=var_""("""_$C(10)_" . set vars=vsroot_""sub)"""_$C(10)_" . set sub="""" for  do  set sub=$order(@vars) quit:'$zlength(sub)"_$C(10)_" . . set varsd=$data(@vars)"_$C(10)_" . . if varsd\10 do dft(vsroot_$zwrite(sub)_"")"")"_$C(10)_" . . else  kill:varsd#10 @(vsroot_$zwrite(sub)_"")"")"_$C(10)_" zkill:vard#10 @var"_$C(10)_" quit"_$C(10)
^%ydbAIMDE7chspaSKyAUuPbW0nWu8C("comment-1")="xref for table CUSTOMERS column FIRST_NAME"
^%ydbAIMDxref("^customers","^%ydbAIMDE7chspaSKyAUuPbW0nWu8C")=""
^%ydbAIMOctoCache("CUSTOMERS","FIRST_NAME","completed?")="1"
^%ydbAIMOctoCache("CUSTOMERS","FIRST_NAME","location")="^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(1)"
# Verify db nodes correctly represent src/obj dirs of generated plans (including xref plans)
^%ydboctoocto("plandirs","$PWD/_ydboctoP*.m","$PWD/_ydboctoP*.o")=""
^%ydboctoocto("plandirs","$PWD/_ydboctoP*.m","$PWD/_ydboctoP*.o")=""
^%ydboctoocto("plandirs","$PWD/_ydboctoX*.m","$PWD/_ydboctoX*.o")=""
# Verify currently installed triggers
;trigger name: %ydbE7chspaSKyAUuPbW0nWu8CS (region DEFAULT)  cycle: 4
+^customers(sub1=*) -name=%ydbE7chspaSKyAUuPbW0nWu8CS -commands=S -xecute=<<
 for i=1 set p=$piece($ztoldval,"|",i),q=$piece($ztvalue,"|",i) do
 . if p'=q zkill ^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(i,p,sub1) set ^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(i,q,sub1)=""
 . else  set:'$zlength(q) ^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(i,"",sub1)=""
>>
;trigger name: %ydbE7chspaSKyAUuPbW0nWu8CK (region DEFAULT)  cycle: 4
+^customers(sub1=*) -name=%ydbE7chspaSKyAUuPbW0nWu8CK -commands=K -xecute=<<
 do dft($reference) quit
 if ^%ydbAIMDE7chspaSKyAUuPbW0nWu8C
dft(var)
 new sub,vard,vars,varsd,vsroot
 set vard=$data(@var)
 do:vard\10
 . if $qlength(var) set vsroot=$zextract(var,1,$zlength(var)-1)_","
 . else  set vsroot=var_"("
 . set vars=vsroot_"sub)"
 . set sub="" for  do  set sub=$order(@vars) quit:'$zlength(sub)
 . . set varsd=$data(@vars)
 . . if varsd\10 do dft(vsroot_$zwrite(sub)_")")
 . . else  kill:varsd#10 @(vsroot_$zwrite(sub)_")")
 zkill:vard#10 @var
 quit
>>
;trigger name: %ydbE7chspaSKyAUuPbW0nWu8CZ (region DEFAULT)  cycle: 4
+^customers(sub1=*) -name=%ydbE7chspaSKyAUuPbW0nWu8CZ -commands=ZK -xecute="for i=1 zkill ^%ydbAIMDE7chspaSKyAUuPbW0nWu8C(i,$piece($ztoldval,""|"",i),sub1)"
;trigger name: %ydbE7chspaSKyAUuPbW0nWu8C0 (region DEFAULT)  cycle: 4
+^customers -name=%ydbE7chspaSKyAUuPbW0nWu8C0 -commands=K -xecute=<<
 do dft($reference) quit
 if ^%ydbAIMDE7chspaSKyAUuPbW0nWu8C
dft(var)
 new sub,vard,vars,varsd,vsroot
 set vard=$data(@var)
 do:vard\10
 . if $qlength(var) set vsroot=$zextract(var,1,$zlength(var)-1)_","
 . else  set vsroot=var_"("
 . set vars=vsroot_"sub)"
 . set sub="" for  do  set sub=$order(@vars) quit:'$zlength(sub)
 . . set varsd=$data(@vars)
 . . if varsd\10 do dft(vsroot_$zwrite(sub)_")")
 . . else  kill:varsd#10 @(vsroot_$zwrite(sub)_")")
 zkill:vard#10 @var
 quit
>>

