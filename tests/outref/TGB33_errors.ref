
-- Columns belonging to outer and inner query in HAVING/ORDER BY/SELECT (Error)
-- ORDER BY
SELECT ALL 1 FROM customers c GROUP BY last_name ORDER BY EXISTS (SELECT 1 FROM customers n1 ORDER BY count(c.first_name=n1.last_name)=1);
SELECT ALL 1 FROM customers c GROUP BY last_name ORDER BY EXISTS (SELECT 1 FROM customers n1 ORDER BY count(n1.last_name=c.first_name)=1);
SELECT ALL 1 FROM customers c GROUP BY last_name ORDER BY EXISTS (SELECT 1 FROM customers n1 ORDER BY count(n1.last_name=c.first_name)=1);
SELECT ALL 1 FROM customers c GROUP BY first_name ORDER BY EXISTS (SELECT 1 FROM customers n1 ORDER BY count(c.last_name=n1.first_name)=1);

-- HAVING
SELECT ALL 1 FROM customers c GROUP BY last_name HAVING EXISTS (SELECT 1 FROM customers n1 ORDER BY count(c.first_name=n1.last_name)=1);
SELECT ALL 1 FROM customers c GROUP BY last_name HAVING EXISTS (SELECT 1 FROM customers n1 ORDER BY count(n1.last_name=c.first_name)=1);
SELECT ALL 1 FROM customers c GROUP BY last_name HAVING EXISTS (SELECT 1 FROM customers n1 ORDER BY count(n1.last_name=c.first_name)=1);
SELECT ALL 1 FROM customers c GROUP BY first_name HAVING EXISTS (SELECT 1 FROM customers n1 ORDER BY count(c.last_name=n1.first_name)=1);

-- SELECT
SELECT ALL EXISTS (SELECT 1 FROM customers n1 ORDER BY count(c.first_name=n1.last_name)=1) FROM customers c GROUP BY last_name;
SELECT ALL EXISTS (SELECT 1 FROM customers n1 ORDER BY count(n1.last_name=c.first_name)=1) FROM customers c GROUP BY last_name;
SELECT ALL EXISTS (SELECT 1 FROM customers n1 ORDER BY count(n1.last_name=c.first_name)=1) FROM customers c GROUP BY last_name;
SELECT ALL EXISTS (SELECT 1 FROM customers n1 ORDER BY count(c.last_name=n1.first_name)=1) FROM customers c GROUP BY first_name;

-- #807
-- Below should error because non-grouped column is used in an aggregate expression
SELECT ALL 1 FROM customers c having EXISTS (SELECT 1 FROM customers n1 GROUP BY n1.last_name having count(c.first_name=n1.first_name)=1);
SELECT ALL 1 FROM customers c having EXISTS (SELECT 1 FROM customers n1 GROUP BY n1.last_name order by count(c.first_name=n1.first_name)=1);
SELECT ALL first_name FROM customers c GROUP BY first_name HAVING EXISTS (SELECT 1 FROM customers n1 having EXISTS(SELECT 1 from orders n2 group by n2.order_id having count((c.first_name=n1.last_name)=(n2.order_date='test'))=1));
SELECT ALL first_name FROM customers c HAVING EXISTS (SELECT 1 FROM customers n1 having EXISTS(SELECT 1 from orders n2 group by n2.order_id having count(c.first_name=n1.first_name)=1));

-- #806 and #807
SELECT ALL 1 FROM customers c GROUP BY first_name HAVING EXISTS (SELECT 1 FROM customers n1 where count(c.first_name=n1.first_name)=1 GROUP BY n1.last_name);

SELECT ALL 1 FROM customers c GROUP BY last_name HAVING EXISTS (SELECT 1 FROM customers n1 GROUP BY n1.first_name having count(c.first_name=n1.first_name)=1);
SELECT ALL 1 FROM customers c GROUP BY last_name HAVING EXISTS (SELECT 1 FROM customers n1 GROUP BY n1.last_name having count(c.first_name=n1.first_name)=1);
SELECT ALL 1 FROM customers c GROUP BY last_name HAVING EXISTS (SELECT 1 FROM customers n1 GROUP BY n1.last_name having count(c.first_name=n1.last_name)=1);
SELECT ALL first_name FROM customers c GROUP BY first_name HAVING EXISTS (SELECT 1 FROM customers n1 GROUP BY n1.last_name having EXISTS(SELECT 1 from orders n2 group by n2.order_id having count((c.first_name||n1.first_name)=order_amount)=1));
SELECT ALL 1 FROM customers c GROUP BY last_name HAVING EXISTS (SELECT 1 FROM customers n1 GROUP BY n1.last_name having count(c.first_name=n1.first_name)=1);
SELECT ALL 1 FROM customers c GROUP BY last_name HAVING EXISTS (SELECT 1 FROM customers n1 GROUP BY n1.last_name having count(c.first_name=n1.last_name)=1);

-- Edge cases to verify working of aggregate function in inner query having outer query columns when outer query has GROUP BY
SELECT ALL last_name FROM customers c GROUP BY last_name ORDER BY EXISTS (SELECT 1 FROM customers n1 GROUP BY n1.last_name ORDER BY count(c.first_name=n1.last_name)=1);
SELECT ALL last_name FROM customers c ORDER BY EXISTS (SELECT first_name FROM customers n1 ORDER BY count(c.first_name=n1.last_name)=1);
SELECT ALL last_name FROM customers c ORDER BY EXISTS (SELECT first_name FROM customers n1 ORDER BY count(c.first_name=c.last_name)=1);
SELECT ALL last_name FROM customers c ORDER BY EXISTS (SELECT last_name FROM customers n1 GROUP BY last_name ORDER BY count(c.first_name=c.last_name)=1);

-- Outer GROUP BY having an expression and inner query referring to the outer query column using the same expression in GROUP BY
SELECT ALL 1 FROM customers c GROUP BY first_name||'test' HAVING EXISTS (SELECT 1 FROM customers n1 GROUP BY n1.first_name having (c.first_name||'test')=n1.first_name);
SELECT ALL 1 FROM customers c GROUP BY first_name||'test' HAVING EXISTS (SELECT 1 FROM customers n1 GROUP BY n1.first_name having count((c.first_name||'test')=n1.first_name)=2);
SELECT ALL 1 FROM customers c GROUP BY first_name||'test' HAVING EXISTS (SELECT 1 FROM customers n1 GROUP BY n1.first_name order by (c.first_name||'test'));
SELECT ALL 1 FROM customers c GROUP BY first_name||last_name HAVING EXISTS (SELECT 1 FROM customers n1 GROUP BY n1.first_name order by c.first_name||c.last_name);

-- TableAsterisk query
SELECT ALL first_name FROM customers c GROUP BY first_name HAVING EXISTS (SELECT 1 FROM customers n1 GROUP BY n1.first_name having EXISTS(SELECT 1 from orders n2 group by n2.order_id having count((c.* = n1.*) = TRUE)=1));
[ERROR]: ERR_UNGROUPED_OUTER_QUERY_COLUMN: subquery uses ungrouped column FIRST_NAME from outer query
LINE 1: ... FROM customers n1 ORDER BY count(c.first_name=n1.last_name)=1);
                                             ^^^^^^^^^^^^
[ERROR]: ERR_UNGROUPED_OUTER_QUERY_COLUMN: subquery uses ungrouped column FIRST_NAME from outer query
LINE 1: ... FROM customers n1 ORDER BY count(n1.last_name=c.first_name)=1);
                                                          ^^^^^^^^^^^^
[ERROR]: ERR_UNGROUPED_OUTER_QUERY_COLUMN: subquery uses ungrouped column FIRST_NAME from outer query
LINE 1: ... FROM customers n1 ORDER BY count(n1.last_name=c.first_name)=1);
                                                          ^^^^^^^^^^^^
[ERROR]: ERR_UNGROUPED_OUTER_QUERY_COLUMN: subquery uses ungrouped column LAST_NAME from outer query
LINE 1: ...FROM customers n1 ORDER BY count(c.last_name=n1.first_name)=1);
                                            ^^^^^^^^^^^
[ERROR]: ERR_UNGROUPED_OUTER_QUERY_COLUMN: subquery uses ungrouped column FIRST_NAME from outer query
LINE 1: ... FROM customers n1 ORDER BY count(c.first_name=n1.last_name)=1);
                                             ^^^^^^^^^^^^
[ERROR]: ERR_UNGROUPED_OUTER_QUERY_COLUMN: subquery uses ungrouped column FIRST_NAME from outer query
LINE 1: ... FROM customers n1 ORDER BY count(n1.last_name=c.first_name)=1);
                                                          ^^^^^^^^^^^^
[ERROR]: ERR_UNGROUPED_OUTER_QUERY_COLUMN: subquery uses ungrouped column FIRST_NAME from outer query
LINE 1: ... FROM customers n1 ORDER BY count(n1.last_name=c.first_name)=1);
                                                          ^^^^^^^^^^^^
[ERROR]: ERR_UNGROUPED_OUTER_QUERY_COLUMN: subquery uses ungrouped column LAST_NAME from outer query
LINE 1: ...FROM customers n1 ORDER BY count(c.last_name=n1.first_name)=1);
                                            ^^^^^^^^^^^
[ERROR]: ERR_UNGROUPED_OUTER_QUERY_COLUMN: subquery uses ungrouped column FIRST_NAME from outer query
LINE 1: ...stomers n1 ORDER BY count(c.first_name=n1.last_name)=1) FROM cus...
                                     ^^^^^^^^^^^^
[ERROR]: ERR_UNGROUPED_OUTER_QUERY_COLUMN: subquery uses ungrouped column FIRST_NAME from outer query
LINE 1: ...DER BY count(n1.last_name=c.first_name)=1) FROM customers c GROU...
                                     ^^^^^^^^^^^^
[ERROR]: ERR_UNGROUPED_OUTER_QUERY_COLUMN: subquery uses ungrouped column FIRST_NAME from outer query
LINE 1: ...DER BY count(n1.last_name=c.first_name)=1) FROM customers c GROU...
                                     ^^^^^^^^^^^^
[ERROR]: ERR_UNGROUPED_OUTER_QUERY_COLUMN: subquery uses ungrouped column LAST_NAME from outer query
LINE 1: ...stomers n1 ORDER BY count(c.last_name=n1.first_name)=1) FROM cu...
                                     ^^^^^^^^^^^
[ERROR]: ERR_UNGROUPED_OUTER_QUERY_COLUMN: subquery uses ungrouped column FIRST_NAME from outer query
LINE 1: ...OUP BY n1.last_name having count(c.first_name=n1.first_name)=1);
                                            ^^^^^^^^^^^^
[ERROR]: ERR_UNGROUPED_OUTER_QUERY_COLUMN: subquery uses ungrouped column FIRST_NAME from outer query
LINE 1: ...P BY n1.last_name order by count(c.first_name=n1.first_name)=1);
                                            ^^^^^^^^^^^^
[ERROR]: ERR_UNGROUPED_OUTER_QUERY_COLUMN: subquery uses ungrouped column LAST_NAME from outer query
LINE 1: ...aving count((c.first_name=n1.last_name)=(n2.order_date='test'))=...
                                     ^^^^^^^^^^^^
[ERROR]: ERR_GROUP_BY_OR_AGGREGATE_FUNCTION: Column FIRST_NAME must appear in the GROUP BY clause or be used in an aggregate function
LINE 1: SELECT ALL first_name FROM customers c HAVING EXISTS (SELECT 1 F...
                   ^^^^^^^^^^
[ERROR]: ERR_AGGREGATE_FUNCTION_WHERE: Aggregate functions are not allowed in WHERE
LINE 1: ...where count(c.first_name=n1.first_name)=1 GROUP BY n1.last_name...
                                    ^^^^^^^^^^^^^
[ERROR]: ERR_UNGROUPED_OUTER_QUERY_COLUMN: subquery uses ungrouped column FIRST_NAME from outer query
LINE 1: ...UP BY n1.first_name having count(c.first_name=n1.first_name)=1);
                                            ^^^^^^^^^^^^
[ERROR]: ERR_UNGROUPED_OUTER_QUERY_COLUMN: subquery uses ungrouped column FIRST_NAME from outer query
LINE 1: ...OUP BY n1.last_name having count(c.first_name=n1.first_name)=1);
                                            ^^^^^^^^^^^^
[ERROR]: ERR_UNGROUPED_OUTER_QUERY_COLUMN: subquery uses ungrouped column FIRST_NAME from outer query
LINE 1: ...ROUP BY n1.last_name having count(c.first_name=n1.last_name)=1);
                                             ^^^^^^^^^^^^
[ERROR]: ERR_UNGROUPED_OUTER_QUERY_COLUMN: subquery uses ungrouped column FIRST_NAME from outer query
LINE 1: ...d having count((c.first_name||n1.first_name)=order_amount)=1));
                                         ^^^^^^^^^^^^^
[ERROR]: ERR_UNGROUPED_OUTER_QUERY_COLUMN: subquery uses ungrouped column FIRST_NAME from outer query
LINE 1: ...OUP BY n1.last_name having count(c.first_name=n1.first_name)=1);
                                            ^^^^^^^^^^^^
[ERROR]: ERR_UNGROUPED_OUTER_QUERY_COLUMN: subquery uses ungrouped column FIRST_NAME from outer query
LINE 1: ...ROUP BY n1.last_name having count(c.first_name=n1.last_name)=1);
                                             ^^^^^^^^^^^^
[ERROR]: ERR_UNGROUPED_OUTER_QUERY_COLUMN: subquery uses ungrouped column FIRST_NAME from outer query
LINE 1: ...UP BY n1.last_name ORDER BY count(c.first_name=n1.last_name)=1);
                                             ^^^^^^^^^^^^
[ERROR]: ERR_GROUP_BY_OR_AGGREGATE_FUNCTION: Column FIRST_NAME must appear in the GROUP BY clause or be used in an aggregate function
LINE 1: ... c ORDER BY EXISTS (SELECT first_name FROM customers n1 ORDER BY...
                                      ^^^^^^^^^^
[ERROR]: ERR_GROUP_BY_OR_AGGREGATE_FUNCTION: Column LAST_NAME must appear in the GROUP BY clause or be used in an aggregate function
LINE 1: SELECT ALL last_name FROM customers c ORDER BY EXISTS (SELECT f...
                   ^^^^^^^^^
[ERROR]: ERR_GROUP_BY_OR_AGGREGATE_FUNCTION: Column LAST_NAME must appear in the GROUP BY clause or be used in an aggregate function
LINE 1: SELECT ALL last_name FROM customers c ORDER BY EXISTS (SELECT l...
                   ^^^^^^^^^
[ERROR]: ERR_UNGROUPED_OUTER_QUERY_COLUMN: subquery uses ungrouped column FIRST_NAME from outer query
LINE 1: ...P BY n1.first_name having (c.first_name||'test')=n1.first_name);
                                      ^^^^^^^^^^^^
[ERROR]: ERR_UNGROUPED_OUTER_QUERY_COLUMN: subquery uses ungrouped column FIRST_NAME from outer query
LINE 1: ....first_name having count((c.first_name||'test')=n1.first_name)=2...
                                     ^^^^^^^^^^^^
[ERROR]: ERR_UNGROUPED_OUTER_QUERY_COLUMN: subquery uses ungrouped column FIRST_NAME from outer query
LINE 1: ...mers n1 GROUP BY n1.first_name order by (c.first_name||'test'));
                                                    ^^^^^^^^^^^^
[ERROR]: ERR_UNGROUPED_OUTER_QUERY_COLUMN: subquery uses ungrouped column FIRST_NAME from outer query
LINE 1: ...s n1 GROUP BY n1.first_name order by c.first_name||c.last_name);
                                                ^^^^^^^^^^^^
[ERROR]: ERR_UNGROUPED_OUTER_QUERY_COLUMN: subquery uses ungrouped column C.* from outer query
LINE 1: ... n2 group by n2.order_id having count((c.* = n1.*) = TRUE)=1));
                                                  ^
